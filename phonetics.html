<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<h1>PiPlexion - Phonetics Lab</h1>
<link rel="icon" href="favicon.png" type="image/png">
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Navigation Menu -->
<nav>
  <a href="index.html">Home</a> |
  <a href="morphology.html">Morphology Lab</a> |
  <a href="syntax.html">Syntax Lab</a> |
  <a href="semantics.html">Semantics Lab</a> |
  <a href="pragmatics.html">Pragmatics Lab</a> |
  <a href="discourse.html">Discourse Lab</a> |
  <a href="about.html">About</a>
</nav>
<hr>

<h2>Phonetics & Phonology Lab</h2>
<p>Analyze syllable structure, consonant clusters, and C/V patterns interactively.</p>

<!-- C/V Pattern Tool -->
<section id="cvPatternTool" class="tool-box">
  <h3>C/V Pattern</h3>
  <input id="word" placeholder="Enter a word">
  <br>
  <button onclick="analyze()">Analyze</button>
  <pre id="output">Your C/V pattern will appear here...</pre>
</section>

<!-- IPA-based C/V Pattern Tool -->
<section id="ipaCvPatternTool" class="tool-box">
  <h3>IPA-based C/V Pattern</h3>
  <input type="text" id="ipaInput" placeholder="Enter IPA transcription, e.g. /tʃeɪndʒ/">
  <br>
  <button onclick="generateCV()">Generate C/V Pattern</button>
  <pre id="ipaOutput">Your IPA C/V pattern will appear here...</pre>
</section>

<!-- Scripts -->
<script>
function analyze() {
  const word = document.getElementById("word").value.trim().toLowerCase();
  if(word === "") {
    alert("Please enter a word!");
    return;
  }

  const vowels = ['a','e','i','o','u'];
  const consonants = 'bcdfghjklmnpqrstvwxyz'.split('');
  
  let cvPattern = '';
  for (let char of word) {
    if (vowels.includes(char)) cvPattern += 'V';
    else if (consonants.includes(char)) cvPattern += 'C';
    else cvPattern += char;
  }

  document.getElementById("output").innerText =
    "Word: " + word + "\nC/V Pattern: " + cvPattern;
}

function generateCV() {
  let ipa = document.getElementById("ipaInput").value.trim();
  if(ipa === "") {
    alert("Please enter an IPA transcription!");
    return;
  }

  ipa = ipa.replace(/[\/\[\]\sˈˌː]/g, "");

  const diphthongs = ["aɪ","aʊ","ɔɪ","eɪ","oʊ","ɪə","eə","ʊə"];
  const vowels = ["i","ɪ","e","ɛ","æ","a","ɑ","ɒ","ɔ","o","ʊ","u","ʌ","ə","ɜ","ɚ","ɝ","ɐ","œ","ø","y","ɨ"];
  const affricates = ["tʃ","dʒ","ts","dz","tɕ","dʑ","tʂ","dʐ"];

  let pattern = "";
  let i = 0;

  while(i < ipa.length){
    let matched = false;

    for(let aff of affricates){
      if(ipa.startsWith(aff,i)){
        pattern += "C";
        i += aff.length;
        matched = true;
        break;
      }
    }
    if(matched) continue;

    for(let dip of diphthongs){
      if(ipa.startsWith(dip,i)){
        pattern += "V";
        i += dip.length;
        matched = true;
        break;
      }
    }
    if(matched) continue;

    if(vowels.includes(ipa[i])){
      pattern += "V";
    } else {
      pattern += "C";
    }
    i++;
  }

  document.getElementById("ipaOutput").innerText =
    "IPA: " + ipa + "\nC/V Pattern: " + pattern;
}
</script>

<!-- Consonant Clusters Tool -->
<section id="ConsonantClustersTool" class="tool-box">
  <h3>Consonant Clusters</h3>
  <p>Enter phonetic transcription (IPA) to see the consonant cluster breakdown:</p>
  <input type="text" id="clusterInput" placeholder="e.g., striŋ">
  <button id="clusterButton">Analyze Cluster</button>

  <div class="cluster-output">
    <input type="text" id="preInitial" placeholder="Pre-initial" readonly>
    <input type="text" id="initial" placeholder="Initial" readonly>
    <input type="text" id="postInitial" placeholder="Post-initial" readonly>
    <input type="text" id="peak" placeholder="Peak" readonly>
    <input type="text" id="preFinal" placeholder="Pre-final" readonly>
    <input type="text" id="final" placeholder="Final" readonly>
    <input type="text" id="postFinal1" placeholder="Post-final 1" readonly>
    <input type="text" id="postFinal2" placeholder="Post-final 2" readonly>
    <input type="text" id="postFinal3" placeholder="Post-final 3" readonly>
  </div>
</div>

<link rel="stylesheet" href="style.css">

<script>
document.getElementById('clusterButton').addEventListener('click', function() {
  let ipa = document.getElementById('clusterInput').value.trim().toLowerCase();

  // Reset all boxes
  ['preInitial','initial','postInitial','peak','preFinal','final','postFinal1','postFinal2','postFinal3'].forEach(id => {
    document.getElementById(id).value = '';
  });

  // Pre-final consonants
  const preFinalConsonants = ['m','n','ŋ','l','s'];

  // Vowels (monophthongs + diphthongs)
  const vowels = ['i','ɪ','e','ɛ','æ','ɑ','ɒ','ɔ','ʊ','u','ʌ','ə','eɪ','aɪ','ɔɪ','aʊ','oʊ','ɪə','eə','ʊə'];

  // Multi-character consonants (affricates/digraphs)
  const multiConsonants = ['tʃ','dʒ','ʃ','θ','ð','ŋ','ʒ','hw','ɹ'];

  // Function to split IPA into logical segments (affricates treated as single)
  function splitIPA(str){
    let arr = [];
    for(let i=0;i<str.length;i++){
      let twoChar = str[i]+(str[i+1]||'');
      if(multiConsonants.includes(twoChar)){
        arr.push(twoChar);
        i++;
      } else {
        arr.push(str[i]);
      }
    }
    return arr;
  }

  let ipaArr = splitIPA(ipa);

  // Detect peak (vowel/diphthong)
  let peakIndex = -1;
  for(let i=0;i<ipaArr.length;i++){
    // Check two-char diphthongs
    let twoChar = ipaArr[i]+(ipaArr[i+1]||'');
    if(vowels.includes(twoChar)){
      peakIndex = i;
      break;
    } else if(vowels.includes(ipaArr[i])){
      peakIndex = i;
      break;
    }
  }
  if(peakIndex === -1) peakIndex = ipaArr.length-1; // default last char as peak

  // Assign peak (single or diphthong)
  let peak = ipaArr[peakIndex];
  if(peakIndex<ipaArr.length-1 && vowels.includes(peak+ipaArr[peakIndex+1])){
    peak += ipaArr[peakIndex+1];
    ipaArr.splice(peakIndex,2,peak);
  }

  // Pre-peak letters
  let prePeak = ipaArr.slice(0, peakIndex);
  let postPeak = ipaArr.slice(peakIndex+1);

  // Assign boxes
  let preInitial = prePeak[0]||'';
  let initial = prePeak[1]||'';
  let postInitial = prePeak[2]||'';

  let preFinal='', final='', postFinal=[];

  if(postPeak.length>0){
    // If last consonant is pre-final type, assign preFinal
    let lastChar = postPeak[postPeak.length-1];
    let secondLast = postPeak[postPeak.length-2]||'';
    if(preFinalConsonants.includes(secondLast)){
      preFinal = secondLast;
      final = lastChar;
      postFinal = postPeak.slice(0, postPeak.length-2);
    } else if(preFinalConsonants.includes(lastChar)){
      preFinal = lastChar;
      postFinal = postPeak.slice(0, postPeak.length-1);
    } else {
      final = lastChar;
      postFinal = postPeak.slice(0, postPeak.length-1);
    }
  }

  // Fill boxes
  document.getElementById('preInitial').value = preInitial;
  document.getElementById('initial').value = initial;
  document.getElementById('postInitial').value = postInitial;
  document.getElementById('peak').value = peak;
  document.getElementById('preFinal').value = preFinal;
  document.getElementById('final').value = final;
  for(let i=0;i<3;i++){
    if(postFinal[i]) document.getElementById('postFinal'+(i+1)).value = postFinal[i];
  }
});
</script>

<!-- Footer -->
<footer>
  <hr>
  <p>
    © 2026 <strong>PiPlexion</strong>.<br>
    This web app (including text, interface, and underlying code) is licensed under a
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">
      Creative Commons Attribution–NonCommercial–NoDerivatives 4.0 International License
    </a>.<br>
    Please cite PiPlexion when using this tool for academic or educational purposes.<br>
    Website: <a href="https://piplexion.github.io" target="_blank">https://piplexion.github.io</a>
  </p>
</footer>

</body>
</html>

